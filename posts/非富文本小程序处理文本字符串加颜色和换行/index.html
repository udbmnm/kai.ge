<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=凯哥><meta name=description content="文本字符串示例： let str = '活动规则文案活动规则&amp;lt;b&amp;gt;文案活动&amp;lt;/b&amp;gt;规则换行\n文案活动规则文案活动规则文案活动规则换行\n文案活动规则文案&amp;lt;b&amp;gt;重点文案&amp;lt;/b"><meta name=keywords content=kai.ge,凯哥博客,blog,hugo><link rel=canonical href=https://kai.ge/posts/%E9%9D%9E%E5%AF%8C%E6%96%87%E6%9C%AC%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%A4%84%E7%90%86%E6%96%87%E6%9C%AC%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8A%A0%E9%A2%9C%E8%89%B2%E5%92%8C%E6%8D%A2%E8%A1%8C/><title>非富文本小程序处理文本字符串加颜色和换行 &middot; 凯哥的个人网站</title><link rel="shortcut icon" href=https://kai.ge/images/favicon.ico><link rel=stylesheet href=https://kai.ge/css/animate.min.css><link rel=stylesheet href=https://kai.ge/css/remixicon.css><link rel=stylesheet href=https://kai.ge/css/zozo.css><link rel=stylesheet href=https://kai.ge/css/highlight.css></head><body><div class="main animated"><div class="nav_container animated fadeInDown"><div class=site_nav id=site_nav><ul><li><a href=/>首页</a></li><li><a href=/posts/>归档</a></li><li><a href=/tags/>标签</a></li><li><a href=/books>读书</a></li><li><a href=/fav>好站</a></li><li><a href=/about/>关于</a></li></ul></div><div class=menu_icon><a id=menu_icon><i class=remixicon-links-line></i></a></div></div><div class="header animated fadeInDown"><div class=site_title_container><div class=site_title><h1><a href=https://kai.ge><span>凯哥的个人网站</span>
<img src=https://kai.ge/images/logo.svg></a></h1></div><div class=description><p class=sub_title>kai.ge</p><div class=my_socials><a href=https://github.com/udbmnm title=github target=_blank><i class=remixicon-github-fill></i></a><a href=https://twitter.com/udbmnm title=twitter target=_blank><i class=remixicon-twitter-fill></i></a><a href=https://kai.ge/index.xml type=application/rss+xml title=rss target=_blank><i class=remixicon-rss-fill></i></a></div></div></div></div><div class=content><div class=post_page><div class="post animated fadeInDown"><div class="post_title post_detail_title"><h2><a href=/posts/%E9%9D%9E%E5%AF%8C%E6%96%87%E6%9C%AC%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%A4%84%E7%90%86%E6%96%87%E6%9C%AC%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8A%A0%E9%A2%9C%E8%89%B2%E5%92%8C%E6%8D%A2%E8%A1%8C/>非富文本小程序处理文本字符串加颜色和换行</a></h2><span class=date>2019.08.16</span></div><div class="post_content markdown"><p>文本字符串示例：</p><pre><code>let str = '活动规则文案活动规则&lt;b&gt;文案活动&lt;/b&gt;规则换行\n文案活动规则文案活动规则文案活动规则换行\n文案活动规则文案&lt;b&gt;重点文案&lt;/b&gt;活动规则文案活动规则&lt;b&gt;文案活动&lt;/b&gt;规则文案活动规则文案活动规则文案活动规则文案活动规则文案&lt;b&gt;重点文案&lt;/b&gt;活动规则文案活动规则&lt;b&gt;文案活动&lt;/b&gt;规则文案活动规则文案活动规则文案活动规则文案活动规则文案&lt;b&gt;重点文案&lt;/b&gt;活动规则文案活动规则&lt;b&gt;文案活动&lt;/b&gt;规则文案活动规则文案活动规则文案活动规则文案活动规则文案&lt;b&gt;重点文案&lt;/b&gt;活动规则文案活动规则&lt;b&gt;文案活动&lt;/b&gt;规则文案活动规则文案活动规则文案活动规则文案活动规则文案&lt;b&gt;重点文案&lt;/b&gt;活动规则文案活动规则&lt;b&gt;文案活动&lt;/b&gt;规则文案活动规则文案活动规则文案活动规则文案活动规则文案&lt;b&gt;重点文案&lt;/b&gt;活动规则文案活动规则&lt;b&gt;文案活动&lt;/b&gt;规则文案活动规则文案活动规则文案活动规则文案活动规则文案&lt;b&gt;重点文案&lt;/b&gt;活动规则文案活动规则&lt;b&gt;文案活动&lt;/b&gt;规则文案活动规则文案活动规则文案活动规则文案活动规则文案&lt;b&gt;重点文案&lt;/b&gt;活动规则文案活动规则&lt;b&gt;文案活动&lt;/b&gt;规则文案活动规则文案活动规则文案活动规则文案活动规则文案&lt;b&gt;重点文案&lt;/b&gt;活动规则文案活动规则&lt;b&gt;文案活动&lt;/b&gt;规则文案活动规则文案活动规则文案活动规则文案活动规则文案&lt;b&gt;重点文案&lt;/b&gt;活动规则文案活动规则&lt;b&gt;文案活动&lt;/b&gt;规则文案活动规则文案活动规则文案活动规则文案活动规则文案&lt;b&gt;重点文案&lt;/b&gt;'

</code></pre><p><code>&lt;b&gt;&lt;/b&gt;包裹的文本加颜色遇到\n换行</code></p><pre><code class=language-javascript>handleRuleText (text, color) {
	let textArr = [];
	if(text &amp;&amp; text.length) {
		while (text.length) {
			let startIndex = text.indexOf('&lt;b&gt;');
			let endIndex = text.indexOf('&lt;/b&gt;');
			let tempText = {};
			// 有颜色
			if (startIndex === 0 ) {
				if(endIndex &gt; -1) {
					tempText = {
						text: text.substring(startIndex + 3, endIndex),
						color
					};
					text = text.substring(endIndex + 4);
				}else{//只有&lt;b&gt;没有结束标签的情况
					tempText = {
						text: text.substring(0),
						color: ''
					}
					text = '';
				}

			} else {
				if (startIndex &gt; -1) {
					tempText = {
						text: text.substring(0, startIndex), // 取文本到&lt;b&gt;截止
						color: ''
					}
					text = text.substring(startIndex);// 剩余文本
				} else {
					tempText = {
						text: text.substring(0),
						color: ''
					}
					text = '';
				}
			}
			if (tempText.text.includes('\\n')) { // 有换行
				let arr = tempText.text.split('\\n');
				arr.forEach((item, index) =&gt; {
					textArr.push({
						text: item,
						color: tempText.color,
						newline: index &gt; 0 // 第二个文本才换行
					});
				});
			} else {
				textArr.push(tempText);
			}
		}
	}

	return textArr;
}
</code></pre><p>wxml渲染</p><pre><code>&lt;block wx:for=&quot;{{tinyRule.text}}&quot;&gt;
	 &lt;view wx:if=&quot;{{item.newline}}&quot;&gt;&lt;/view&gt;
	 &lt;text style=&quot;color:{{item.color}}&quot; &gt;{{item.text}}&lt;/text&gt;
&lt;/block&gt;

</code></pre></div><div class=post_footer><div class=meta><div class=info><span class="field tags"><i class=remixicon-stack-line></i><a href=https://kai.ge/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/>小程序</a></span></div></div></div></div><div class=doc_comments><div id=gitalk-container></div></div><link rel=stylesheet href=https://unpkg.com/gitalk/dist/gitalk.css><script src=https://unpkg.com/gitalk/dist/gitalk.min.js></script><script type=text/javascript>let gitalk=new Gitalk({clientID:'9c198be155c7caafd8b8',clientSecret:'e50131240f0cf6e73848e160726d174ab8a038a0',repo:'kai.ge',owner:'udbmnm',admin:['udbmnm'],id:'2019-08-16 16:20:22 \x2b0800 CST',distractionFreeMode:false,title:'非富文本小程序处理文本字符串加颜色和换行',labels:[]});gitalk.render('gitalk-container')</script></div></div><a id=back_to_top href=# class=back_to_top><span>△</span></a></div><footer class=footer><div class=powered_by><a href=http://www.gohugo.io/ target=_blank>Proudly published with Hugo.</a>
<a href=https://github.com/zhoukai0620/hugo-theme-zozo target=_blank>Designed by Zeuk</a>
<a href=http://www.beian.miit.gov.cn target=_blank>粤ICP备16043072号-1</a></div></footer><script>var _hmt=_hmt||[];(function(){var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?b133881eb41db2b2c6030a4257c40dcc";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script><script src=https://kai.ge/js/jquery-3.3.1.min.js></script><script src=https://kai.ge/js/zozo.js></script><script src=https://kai.ge/js/highlight.pack.js></script><link href=https://kai.ge/css/fancybox.min.css rel=stylesheet><script src=https://kai.ge/js/fancybox.min.js></script><script>hljs.initHighlightingOnLoad()</script><script type=text/javascript async src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\[\[','\]\]']],processEscapes:true,processEnvironments:true,skipTags:['script','noscript','style','textarea','pre'],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}});MathJax.Hub.Queue(function(){var all=MathJax.Hub.getAllJax(),i;for(i=0;i<all.length;i+=1){all[i].SourceElement().parentNode.className+=' has-jax';}});</script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:#515151}</style></body></html>